<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lasse Hjorth Madsen">
<meta name="dcterms.date" content="2023-05-24">

<title>Janowski Formulars</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Janowski Formulars</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Home</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analyses/explore-emg.html" class="sidebar-item-text sidebar-link">Explore EMG Normalization</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analyses/met-precision.html" class="sidebar-item-text sidebar-link">Match Equity Precision</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analyses/janowski.html" class="sidebar-item-text sidebar-link active">Janowski Formulars</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#why-this" id="toc-why-this" class="nav-link active" data-scroll-target="#why-this">Why this?</a></li>
  <li><a href="#how-xg-works" id="toc-how-xg-works" class="nav-link" data-scroll-target="#how-xg-works">How XG works</a></li>
  <li><a href="#janowski-formulas" id="toc-janowski-formulas" class="nav-link" data-scroll-target="#janowski-formulas">Janowski formulas</a></li>
  <li><a href="#money-game-examples" id="toc-money-game-examples" class="nav-link" data-scroll-target="#money-game-examples">Money game examples</a>
  <ul class="collapse">
  <li><a href="#opening-game" id="toc-opening-game" class="nav-link" data-scroll-target="#opening-game">Opening game</a></li>
  <li><a href="#bear-off-position" id="toc-bear-off-position" class="nav-link" data-scroll-target="#bear-off-position">Bear-off position</a></li>
  <li><a href="#middle-game" id="toc-middle-game" class="nav-link" data-scroll-target="#middle-game">Middle game</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Janowski Formulars</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lasse Hjorth Madsen </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 24, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">

</div>
<section id="why-this" class="level2">
<h2 class="anchored" data-anchor-id="why-this">Why this?</h2>
<p>This note is for better understanding exactly what eXtreme Gammon does to estimate cubeless and cubeful equities at money and match play. In particular, we apply the Janowski Formular(s) and try to figure out what it means when the eXtreme Gammon Documentation says that “In eXtreme Gammon the Janowski formula has been extended to apply also in match play”.</p>
</section>
<section id="how-xg-works" class="level2">
<h2 class="anchored" data-anchor-id="how-xg-works">How XG works</h2>
<p>They basic mechanism is this:</p>
<ul>
<li><p>A neural net evaluates a position and come up with six probabilities for either winning or losing a regular game, a gammon and a backgammon. The estimated probabilities are for cubeless money game: What will happen if the game is played to conclusion with no doubling cube at money game conditions.</p></li>
<li><p>To improve the quality of this estimate, a weighted average of all possible positions after one and after two rolls is calculated; what we call 2- and 3-ply evaluations. The initial neural net evaluation is 1-ply.</p></li>
<li><p>From the estimated probability distribution, it is easy to calculate an expected, or average outcome, the <em>equity</em> of the position. This is still assuming money game with no doubling cube. Since that situation <em>never</em> happens, the number is not terribly relevant. Therefore, XG tries to estimate what the <em>cubeful</em> equity is, using <a href="https://bkgm.com/articles/Janowski/cubeformulae.pdf">formulas</a> develped by Rick Janowski.</p></li>
</ul>
</section>
<section id="janowski-formulas" class="level2">
<h2 class="anchored" data-anchor-id="janowski-formulas">Janowski formulas</h2>
<p>We won’t explain in detail how Rick Janowski’s formulars work (that is in the article linked above), we’ll just show an example.</p>
<p>As mentioned , a game of backgammon played to conclusion can end in six possible ways. A certain position in Janowski’s article, have the following probabilities of each outcome:</p>
<div class="cell">
<div class="cell-output-display">

<table>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Regular </th>
   <th style="text-align:right;"> Gammon </th>
   <th style="text-align:right;"> Backgammon </th>
   <th style="text-align:right;"> Sum </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Player wins </td>
   <td style="text-align:right;width: 3.1cm; "> 0.47 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.17 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.01 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.65 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Opponent wins </td>
   <td style="text-align:right;width: 3.1cm; "> 0.31 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.04 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.00 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.35 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sum </td>
   <td style="text-align:right;width: 3.1cm; "> 0.78 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.21 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.01 </td>
   <td style="text-align:right;width: 3.1cm; "> 1.00 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>Suppose the relative gammon and backgammon frequencies stay constant as the chance to win changes. Then, the average win will be:</p>
<p><span class="math display">\[W=\frac{47 \times 1  + 17 \times 2 + 1 \times 3}{47 + 17 + 1} = 1.292\ points\]</span> The average loss will be:</p>
<p><span class="math display">\[L=\frac{31 \times 1  + 4 \times 2 + 0 \times 3}{31 + 4 + 0} = 1.114\ points\]</span></p>
<p>The take point, taking recubes into account is:</p>
<p><span class="math display">\[TP= \frac{L-0.5}{W+L+0.5x}\]</span></p>
<p>where <span class="math inline">\(x\)</span> is what Janowski calls the <em>cube-life index</em>, a number between 0 (where the cube is dead) and 1, where all doubles are efficient, i.e.&nbsp;right at the borderline between take and pass.</p>
<p>The <em>equity</em>, as a function of game winning chances, <span class="math inline">\(p\)</span> and cube location (<em>player</em>, <em>center</em>, <em>opponent</em>) is:</p>
<p><span class="math display">\[E_{player}= p(W+L+0.5x)-L\]</span> <span class="math display">\[E_{center}= p(W+L+0.5x)-L-0.5x\]</span> <span class="math display">\[E_{opponent}= \frac{4}{4-x}(p(W+L+0.5x)-L-0.25x)\]</span></p>
<p>From these, we can estimate cube actions and the size of any cube errors.</p>
<p>A couple of observations:</p>
<ul>
<li><p>It shouldn’t be too difficult to extend this to match play, since <span class="math inline">\(W\)</span> and <span class="math inline">\(L\)</span> can be calculated with match equities, rather than 1, 2, 3 for regular, gammon and backgammon.</p></li>
<li><p>It is a simplification to assume that gammon frequencies remain and cube-life remain constant through a game; near conclusion games are more likely to be races without gammons and fewer opportunities to double efficiently.</p></li>
</ul>
<p>Let’s do this with a few practical examples and check if the formulas agree with what XG says.</p>
</section>
<section id="money-game-examples" class="level2">
<h2 class="anchored" data-anchor-id="money-game-examples">Money game examples</h2>
<section id="opening-game" class="level3">
<h3 class="anchored" data-anchor-id="opening-game">Opening game</h3>
<p>Let’s look at a position after Black opens with 21, slotting:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="janowski_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>According to XG 1-ply, the probabilities of the six possible outcomes of the game, if played to conclusion, are as follows:</p>
<div class="cell">
<div class="cell-output-display">

<table>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Regular </th>
   <th style="text-align:right;"> Gammon </th>
   <th style="text-align:right;"> Backgammon </th>
   <th style="text-align:right;"> Sum </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Player wins </td>
   <td style="text-align:right;width: 3.1cm; "> 0.3571 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.1316 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.0102 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.4989 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Opponent wins </td>
   <td style="text-align:right;width: 3.1cm; "> 0.3654 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.1285 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.0072 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.5011 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sum </td>
   <td style="text-align:right;width: 3.1cm; "> 0.7225 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.2601 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.0174 </td>
   <td style="text-align:right;width: 3.1cm; "> 1.0000 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>This comes to a cubeless equity of: <span class="math inline">\(E = 0.0069\)</span>; White is a slight underdog to win, but is compensated by a tiny bit of extra gammons and backgammons, so that the game is basically even.</p>
<p>Note that the numbers that XG reports are probabilities for winning (<em>including</em> gammons and backgammons), gammon (<em>including</em> backgammon), and backgammon. So they have to be converted to get probabilities that sum to 1. (My R-package, <a href="https://lassehjorthmadsen.github.io/backgammon/index.html"><code>backgammon</code></a> has a function for that.)</p>
<p>If we apply Janowski’s formulars to the above cubeless probablities, we get:</p>
<div class="cell">

</div>
<ul>
<li>Assuming a <em>dead</em> cube, <span class="math inline">\(x=0\)</span>, White’s take point is: 0.3032</li>
<li>Assuming a perfectly <em>live</em> cube, <span class="math inline">\(x=1\)</span>, White’s take point is: 0.2541</li>
<li>Assuming a <em>dead</em> cube, <span class="math inline">\(x=0\)</span>, Blacks’s take point is: 0.3107</li>
<li>Assuming a perfectly <em>live</em> cube, <span class="math inline">\(x=1\)</span>, Black’s take point is: 0.2604</li>
</ul>
<p>All these numbers align perfectly with what you get when you consult XGs <code>Analyze|Cube Information</code> menu.</p>
<p>Regarding the cubeful equities for the actual position, we have:</p>
<div class="cell">

</div>
<ul>
<li>White’s equity owning the cube: 0.183</li>
<li>White’s equity with a centered cube: 0.008</li>
<li>White’s equity after double/take: -0.34</li>
</ul>
<p>Which also agrees with what XG says, <em>if we assume a cube-life index of <span class="math inline">\(0.706\)</span></em>. Does XG change the cube-life index depending on the position?</p>
<p>Lets do another example to try to find out.</p>
</section>
<section id="bear-off-position" class="level3">
<h3 class="anchored" data-anchor-id="bear-off-position">Bear-off position</h3>
<div class="cell">
<div class="cell-output-display">
<p><img src="janowski_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">

<table>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Regular </th>
   <th style="text-align:right;"> Gammon </th>
   <th style="text-align:right;"> Backgammon </th>
   <th style="text-align:right;"> Sum </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Player wins </td>
   <td style="text-align:right;width: 3.1cm; "> 0.49694 </td>
   <td style="text-align:right;width: 3.1cm; "> 0 </td>
   <td style="text-align:right;width: 3.1cm; "> 0 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.49694 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Opponent wins </td>
   <td style="text-align:right;width: 3.1cm; "> 0.50306 </td>
   <td style="text-align:right;width: 3.1cm; "> 0 </td>
   <td style="text-align:right;width: 3.1cm; "> 0 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.50306 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sum </td>
   <td style="text-align:right;width: 3.1cm; "> 1.00000 </td>
   <td style="text-align:right;width: 3.1cm; "> 0 </td>
   <td style="text-align:right;width: 3.1cm; "> 0 </td>
   <td style="text-align:right;width: 3.1cm; "> 1.00000 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<div class="cell">

</div>
<p>With no gammons, the cubeless take point clearly is <span class="math inline">\(0.25\)</span> and the perfectly efficient cubeful take point is <span class="math inline">\(0.20\)</span> which is also what XG reports.</p>
<p>The cubeless equity is also easy to calculate: <span class="math inline">\(E=-0.00612\)</span></p>
<p>The Janowski-style estimated cubeful equities, assuming a cube-life index of <span class="math inline">\(0.622\)</span>, are:</p>
<ul>
<li>White’s equity owning the cube: 0.1484</li>
<li>White’s equity with a centered cube: -0.0084</li>
<li>White’s equity after double/take: -0.3251</li>
</ul>
<p>XG reports <span class="math inline">\(0.1484, -0.0087, -0.3252\)</span> respectively, very close to the calculated values, so it must assume a lower cube value in the second postion, which would also be reasonable in a medium to short length race like this.</p>
<p>Let’s do a final example.</p>
</section>
<section id="middle-game" class="level3">
<h3 class="anchored" data-anchor-id="middle-game">Middle game</h3>
<div class="cell">
<div class="cell-output-display">
<p><img src="janowski_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">

<table>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Regular </th>
   <th style="text-align:right;"> Gammon </th>
   <th style="text-align:right;"> Backgammon </th>
   <th style="text-align:right;"> Sum </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Player wins </td>
   <td style="text-align:right;width: 3.1cm; "> 0.4156 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.2333 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.0305 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.6794 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Opponent wins </td>
   <td style="text-align:right;width: 3.1cm; "> 0.2610 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.0568 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.0028 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.3206 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sum </td>
   <td style="text-align:right;width: 3.1cm; "> 0.6766 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.2901 </td>
   <td style="text-align:right;width: 3.1cm; "> 0.0333 </td>
   <td style="text-align:right;width: 3.1cm; "> 1.0000 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<div class="cell">

</div>
<p>The cubeless equity is: <span class="math inline">\(E=0.5907\)</span></p>
<p>The Janowski-style estimated cubeful equities, assuming a cube-life index of <span class="math inline">\(0.706\)</span>, are:</p>
<ul>
<li>White’s equity owning the cube: 0.8305</li>
<li>White’s equity with a centered cube: 0.7942</li>
<li>White’s equity after double/take: 0.9551</li>
</ul>
<p>XG reports <span class="math inline">\(0.8304, 0.8140, 0.9557\)</span>, again close to the calculated values, although not exactly the same. The reason for the discrepancy (especially with the cube in the middle) is not obvious. (I used 1-ply to make sure the difference is not due to how the numbers gets aggregated at higher plies.)</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>