{
  "hash": "76a5498232f4a4eb8c5f76fdc946aa90",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Confidence intervals for PR\"\nauthor: \"Lasse Hjorth Madsen\"\ndate: today \nformat: \n  html:\n    df-print: paged\n    fig-width: 4\n    fig-height: 4\ntoc: true\ntoc-expand: true\ntoc-depth: 3\neditor: source\nexecute:\n  echo: false\n  warning: false\n  cache: true\n---\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n## Why this?\n\nPerformance Rating, PR, is the defacto standard for measuring playing strength in backgammon. It's the average error per decision (i.e. non-forced and non-trivial play). But for an individual player PR varies a lot from match to match, from tournament to tournament, and over time. This is expected, since players face very different sets of decisions in each match.\n\nA match is, in essence, a random sample of all possible decision one will have to make in backgammon. But random samples vary; some matches are hard, some not so hard. Let's try to examine that variation and to calculate confidence intervals around PR-values, to give an idea of how accurate a given PR-result is.\n\n## Examples\n\nSuppose I estimate my own playing strength at around, say, 5.0 PR. Now suppose I play a 17-point match at 6.0 PR. What is the most reasonable interpretation:\n\n  - That I for some reason played worse than usual, or \n  - That the match was tougher that average?\n    \nFor another example, suppose that I play 8 matches in some tournament, with a combined PR of 4.5. Then, a year later, I play 6.4 in a similar tournament. Is this evidence that my play has gotten worse, or is it as likely to be just statistical noise?\n\nThe last example was a real life experience for me at the qualification tournaments for the Danish national team in 2024 and 2025. It would be nice to more confidently interpret these data.\n\n## The data\n\nWe can use the [`bgmoves`](https://lassehjorthmadsen.github.io/bglab/reference/bgmoves.html) dataset to estimate the *variance* of my errors, which we need to compute confidence intervals around a specific PR result.\n\n`bgmoves` have 191012 positions, some involving both a play and a cube play. Not all positions in the database are decisions; if we pull out all actual decisions from the dataset, we get a subset of 163535 actual decisions.\n\nIn backgammon, the majority of checker play decisions are easy; both my and my opponents get the most checker plays right. Here's a count of checker play decisions, by player and if a an error was made: \n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Turn\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Checker play error made\"],\"name\":[2],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"n\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Percent (by player)\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Lasse\",\"2\":\"FALSE\",\"3\":\"45843\",\"4\":\"75.2\"},{\"1\":\"Lasse\",\"2\":\"TRUE\",\"3\":\"15089\",\"4\":\"24.8\"},{\"1\":\"Opponent\",\"2\":\"FALSE\",\"3\":\"55721\",\"4\":\"70.7\"},{\"1\":\"Opponent\",\"2\":\"TRUE\",\"3\":\"23051\",\"4\":\"29.3\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nSo we got 70-75 percent of all checker play decisions right. One can guess that perhaps half of all checker plays are truly routine; among the other half some are pretty easy, some are too close to care about, and some are real problems. If I get half of the latter group right, that aligns roughly with the numbers above.\n\nCube decisions are different by nature, they are far fewer, but it looks like most are also relatively easy:\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Turn\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Cube error made\"],\"name\":[2],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"n\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Percent (by player)\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Lasse\",\"2\":\"FALSE\",\"3\":\"7316\",\"4\":\"83.1\"},{\"1\":\"Lasse\",\"2\":\"TRUE\",\"3\":\"1488\",\"4\":\"16.9\"},{\"1\":\"Opponent\",\"2\":\"FALSE\",\"3\":\"11477\",\"4\":\"76.4\"},{\"1\":\"Opponent\",\"2\":\"TRUE\",\"3\":\"3545\",\"4\":\"23.6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## PR estimates\n\nWe really wanted to use the data to estimate PR and especially the uncertainty of those estimates, so let's get going.\n\nPR is the average error per decision, where decision is defined as non-obvious moves: Non-forced checker plays; checker plays where all moves are not equal; non-optional cubes; and potential doubles where doubling is a mistake less that 0.200 emg.\n\nWhen we compute PR for a specific game or match or series of matches, it can be seen as an estimate of the true PR based on a random *sample* of all possible decision.\n\nLike this:\n\n\n::: {.cell .column-page-right}\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Turn\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Decisions\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Mean error\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Standard deviation\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"PR\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Confidence interval\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Lasse\",\"2\":\"69737\",\"3\":\"-0.011\",\"4\":\"0.038\",\"5\":\"5.259\",\"6\":\"± 0.141\"},{\"1\":\"Opponent\",\"2\":\"93798\",\"3\":\"-0.017\",\"4\":\"0.054\",\"5\":\"8.469\",\"6\":\"± 0.172\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nSo in this data set I averages a PR of 5.259 ± 0.141. The calculation is based on a *lot* of decisions, 69,737. The mean error (in equivalent-to-money-game, emg) is -0.011, meaning that I on average sacrifice about a percentage of a point on each decision. That may seem low, but recall that it's across *all* decisions, also routine ones, and that most error are zero, so there has to be an occasional big one in there.\n\nThe standard deviation is a measure of how much the errors vary around the mean; we see that the variation is a bit higher for my opponents. That makes sense, since this group includes quite a few inexperienced players, who makes bigger mistakes more frequently.\n\nPR is just the mean error multiplied by -500.\n\nThe [confidence interval, CI](https://en.wikipedia.org/wiki/Confidence_interval) is calculated as the standard deviation divided by the quare root of the number of observations, n:\n\n$$\n\\text{CI} = \\bar{x} \\pm z_{\\alpha/2} \\cdot \\frac{\\sigma}{\\sqrt{n}}\n$$\nWhere:\n\n$$\n\\bar{x} \\text{ = sample mean}\\\\[6pt]\nz_{\\alpha/2} \\text{ = critical value (1.96 for 95\\% confidence)}\\\\[6pt]\n\\sigma \\text{ = standard deviation}\\\\[6pt]\nn \\text{ = number of observations}\n$$\n\n\n\nThe above is a hand-held calculation by me, to display the results nicely; let's just try to use one of the build-in statistical functions in R for to sanity check if the results agree: \n\n\n::: {.cell}\n\n:::\n\n\nMy overall average PR: \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nmean of x \n 5.259142 \n```\n\n\n:::\n:::\n\n\n(Note this is not exactly eXtremeGammon estimates, analysis is done by GNUBG and varies a bit).\n\nThe confidence interval on that estimate:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nmean of x \n0.1412385 \n```\n\n\n:::\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.07206054\n```\n\n\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Turn\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Error type\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Decisions\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Mean error\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Standard deviation\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"PR\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Confidence interval\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Lasse\",\"2\":\"Cube error\",\"3\":\"8805\",\"4\":\"-0.017\",\"5\":\"0.064\",\"6\":\"8.641\",\"7\":\"± 0.66\"},{\"1\":\"Lasse\",\"2\":\"Move error\",\"3\":\"60932\",\"4\":\"-0.010\",\"5\":\"0.033\",\"6\":\"4.770\",\"7\":\"± 0.13\"},{\"1\":\"Opponent\",\"2\":\"Cube error\",\"3\":\"15026\",\"4\":\"-0.028\",\"5\":\"0.086\",\"6\":\"13.991\",\"7\":\"± 0.69\"},{\"1\":\"Opponent\",\"2\":\"Move error\",\"3\":\"78772\",\"4\":\"-0.015\",\"5\":\"0.045\",\"6\":\"7.416\",\"7\":\"± 0.16\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nLet's say you play a 17-point match, with about 230 decisions on average. If your error variance is like mine online error variance,\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}